<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S&P 500 Insider Trading | Herdvibe</title>
    <meta property="og:title" content="S&P 500 Insider Trading | Herdvibe">
    <meta property="og:description" content="S&P 500 ë‚´ë¶€ì(ì„ì›/ì´ì‚¬) ë§¤ìˆ˜Â·ë§¤ë„ ì‹¤ì‹œê°„ ì¶”ì  - SEC Form 4 ê¸°ë°˜">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        ::-webkit-scrollbar { display: none; }
        * { -ms-overflow-style: none; scrollbar-width: none; }

        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #111111;
            --bg-tertiary: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #888888;
            --text-muted: #555555;
            --border-color: #2a2a2a;
            --bid-color: #00d4aa;
            --ask-color: #ff4757;
        }

        html, body { overflow-x: hidden; }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .container { max-width: 1400px; margin: 0 auto; padding: 20px 20px 40px; }

        .header {
            text-align: center; padding: 30px 0 20px;
            border-bottom: 1px solid var(--border-color); margin-bottom: 20px;
        }

        .header h1 {
            font-size: 1.8rem; font-weight: 700; letter-spacing: -0.5px; margin-bottom: 6px;
            background: linear-gradient(135deg, #fff 0%, #888 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }

        .header p { color: var(--text-secondary); font-size: 0.85rem; }

        /* Controls */
        .controls {
            display: flex; align-items: center; justify-content: center;
            gap: 12px; flex-wrap: wrap; margin-bottom: 20px;
        }

        .control-group {
            display: flex; align-items: center; gap: 6px;
        }

        .control-label {
            font-size: 0.72rem; color: var(--text-secondary);
        }

        .ctrl-btn {
            font-family: 'JetBrains Mono', monospace; font-size: 0.72rem;
            padding: 6px 12px; background: var(--bg-tertiary);
            border: 1px solid var(--border-color); border-radius: 6px;
            color: var(--text-secondary); cursor: pointer; transition: all 0.2s;
        }

        .ctrl-btn:hover { border-color: #3a3a3a; }
        .ctrl-btn.active { border-color: var(--bid-color); color: var(--bid-color); background: rgba(0,212,170,0.1); }

        .refresh-btn {
            font-family: 'Noto Sans KR', sans-serif; font-size: 0.72rem;
            padding: 6px 14px; background: var(--bg-tertiary);
            border: 1px solid var(--border-color); border-radius: 6px;
            color: var(--text-secondary); cursor: pointer; transition: all 0.2s;
            display: flex; align-items: center; gap: 5px;
        }

        .refresh-btn:hover { border-color: var(--bid-color); color: var(--bid-color); }
        .refresh-btn.loading { opacity: 0.5; pointer-events: none; }
        .refresh-btn svg { width: 13px; height: 13px; }

        /* Summary */
        .summary-row {
            display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;
            margin-bottom: 20px; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem;
        }

        .summary-item { display: flex; align-items: center; gap: 6px; }
        .summary-item .label { color: var(--text-muted); font-size: 0.7rem; }

        /* Cards / Sections */
        .section {
            background: var(--bg-secondary); border: 1px solid var(--border-color);
            border-radius: 12px; padding: 20px; margin-bottom: 20px;
        }

        .section-title {
            text-align: center; margin-bottom: 15px;
        }

        .section-title h2 {
            font-size: 1.1rem; font-weight: 600;
        }

        .section-title p {
            font-size: 0.75rem; color: var(--text-muted); margin-top: 4px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px; margin-bottom: 20px;
        }

        .stat-card {
            background: var(--bg-tertiary); border: 1px solid var(--border-color);
            border-radius: 8px; padding: 16px; text-align: center;
        }

        .stat-card .stat-label {
            font-size: 0.7rem; color: var(--text-muted); margin-bottom: 6px;
            text-transform: uppercase; letter-spacing: 0.5px;
        }

        .stat-card .stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem; font-weight: 600;
        }

        .stat-card .stat-sub {
            font-size: 0.7rem; color: var(--text-muted); margin-top: 4px;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Chart */
        .chart-container { position: relative; height: 300px; width: 100%; }

        /* Transaction Table */
        .tx-table-wrap {
            overflow-x: auto;
        }

        .tx-table {
            width: 100%; border-collapse: collapse;
        }

        .tx-table thead th {
            font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;
            letter-spacing: 0.8px; font-weight: 500; padding: 10px 12px;
            border-bottom: 1px solid var(--border-color); text-align: left;
            font-family: 'JetBrains Mono', monospace;
            position: sticky; top: 0; background: var(--bg-secondary); z-index: 2;
        }

        .tx-table tbody tr {
            border-bottom: 1px solid rgba(42, 42, 42, 0.5);
            transition: background 0.15s;
        }

        .tx-table tbody tr:hover { background: var(--bg-tertiary); }

        .tx-table td {
            padding: 10px 12px; font-size: 0.78rem; vertical-align: middle;
        }

        .tx-sym {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600; font-size: 0.82rem;
        }

        .tx-company {
            font-size: 0.65rem; color: var(--text-muted); display: block; margin-top: 1px;
        }

        .tx-name { color: var(--text-secondary); font-size: 0.75rem; }
        .tx-role { font-size: 0.62rem; color: var(--text-muted); display: block; margin-top: 1px; }

        .tx-badge {
            display: inline-block; padding: 3px 10px; border-radius: 4px;
            font-size: 0.68rem; font-weight: 600; font-family: 'JetBrains Mono', monospace;
            letter-spacing: 0.3px;
        }

        .tx-badge.buy {
            background: rgba(0, 212, 170, 0.1); color: var(--bid-color);
            border: 1px solid rgba(0, 212, 170, 0.3);
        }

        .tx-badge.sell {
            background: rgba(255, 71, 87, 0.1); color: var(--ask-color);
            border: 1px solid rgba(255, 71, 87, 0.3);
        }

        .tx-value {
            font-family: 'JetBrains Mono', monospace; font-size: 0.75rem;
            text-align: right;
        }

        .tx-shares {
            font-size: 0.62rem; color: var(--text-muted); display: block;
            margin-top: 1px; text-align: right;
        }

        .tx-date {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem; color: var(--text-muted); text-align: right;
        }

        .table-scroll {
            max-height: 550px; overflow-y: auto;
            scrollbar-width: thin; scrollbar-color: #2a2a2a transparent;
        }

        .table-scroll::-webkit-scrollbar { display: block; width: 4px; }
        .table-scroll::-webkit-scrollbar-track { background: transparent; }
        .table-scroll::-webkit-scrollbar-thumb { background: #2a2a2a; border-radius: 2px; }

        /* Top Insiders Grid */
        .insiders-grid {
            display: grid; grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .insider-card {
            background: var(--bg-tertiary); border: 1px solid var(--border-color);
            border-radius: 8px; padding: 16px;
        }

        .insider-card h3 {
            font-size: 0.8rem; font-weight: 600; margin-bottom: 12px;
            display: flex; align-items: center; gap: 6px;
        }

        .insider-row {
            display: flex; align-items: center; gap: 10px;
            padding: 8px 0; border-bottom: 1px solid rgba(42, 42, 42, 0.4);
        }

        .insider-row:last-child { border-bottom: none; }

        .insider-rank {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.68rem; color: var(--text-muted); width: 18px; text-align: center;
        }

        .insider-avatar {
            width: 28px; height: 28px; border-radius: 6px;
            display: flex; align-items: center; justify-content: center;
            font-family: 'JetBrains Mono', monospace; font-weight: 600;
            font-size: 0.7rem; flex-shrink: 0;
        }

        .insider-avatar.buy-av {
            background: rgba(0, 212, 170, 0.1); color: var(--bid-color);
            border: 1px solid rgba(0, 212, 170, 0.25);
        }

        .insider-avatar.sell-av {
            background: rgba(255, 71, 87, 0.1); color: var(--ask-color);
            border: 1px solid rgba(255, 71, 87, 0.25);
        }

        .insider-info { flex: 1; min-width: 0; }
        .insider-info .name {
            font-size: 0.72rem; font-weight: 500; color: var(--text-primary);
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .insider-info .meta { font-size: 0.62rem; color: var(--text-muted); }

        .insider-amt {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.72rem; font-weight: 500; text-align: right;
        }
        .insider-amt.buy-c { color: var(--bid-color); }
        .insider-amt.sell-c { color: var(--ask-color); }

        /* Sector Bars */
        .sector-row { margin-bottom: 10px; }
        .sector-label {
            display: flex; justify-content: space-between;
            font-size: 0.7rem; margin-bottom: 4px;
        }
        .sector-label .name { color: var(--text-secondary); }
        .sector-label .val {
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-muted); font-size: 0.62rem;
        }
        .sector-track {
            height: 6px; background: var(--bg-primary);
            border-radius: 3px; overflow: hidden; display: flex;
        }
        .sector-fill-buy { height: 100%; background: var(--bid-color); border-radius: 3px 0 0 3px; transition: width 0.5s; }
        .sector-fill-sell { height: 100%; background: var(--ask-color); border-radius: 0 3px 3px 0; transition: width 0.5s; }

        /* Loading / Error / No Data */
        .loading-box {
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; padding: 50px 20px; gap: 14px;
        }

        .spinner {
            width: 28px; height: 28px;
            border: 3px solid var(--border-color);
            border-top-color: var(--bid-color);
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .loading-box .msg { font-size: 0.78rem; color: var(--text-muted); }
        .progress-bar-wrap {
            width: 200px; height: 4px; background: var(--border-color);
            border-radius: 2px; overflow: hidden; margin-top: 4px;
        }
        .progress-bar-fill {
            height: 100%; background: var(--bid-color); border-radius: 2px;
            transition: width 0.3s;
        }

        .no-data {
            text-align: center; padding: 30px;
            font-size: 0.78rem; color: var(--text-muted);
        }

        .error-box {
            text-align: center; padding: 40px 20px;
        }
        .error-box .emoji { font-size: 24px; margin-bottom: 10px; }
        .error-box .msg { font-size: 0.78rem; color: var(--text-secondary); }
        .error-box .detail { font-size: 0.68rem; color: var(--text-muted); margin-top: 6px; font-family: 'JetBrains Mono', monospace; }

        /* Share */
        .share-bar { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }

        .share-btn {
            display: flex; align-items: center; gap: 6px; padding: 8px 14px;
            background: transparent; border: 1px solid var(--border-color);
            border-radius: 8px; color: var(--text-secondary); font-size: 0.72rem;
            font-family: 'Noto Sans KR', sans-serif; cursor: pointer; transition: all 0.2s;
        }

        .share-btn svg { width: 14px; height: 14px; }
        .share-btn:hover { background: var(--bg-tertiary); }
        .share-btn.twitter:hover { border-color: #1da1f2; color: #1da1f2; }
        .share-btn.kakao:hover { border-color: #fee500; color: #fee500; }
        .share-btn.telegram:hover { border-color: #26a5e4; color: #26a5e4; }
        .share-btn.instagram:hover { border-color: #E4405F; color: #E4405F; }
        .share-btn.copy-link:hover { border-color: var(--bid-color); color: var(--bid-color); }

        .footer {
            text-align: center; padding: 15px 0; border-top: 1px solid var(--border-color);
            font-size: 0.7rem; color: var(--text-muted); line-height: 1.8;
        }
        .footer a { color: var(--bid-color); text-decoration: none; }

        @media (max-width: 768px) {
            .container { padding: 10px 12px 30px; }
            .header h1 { font-size: 1.3rem; }
            .insiders-grid { grid-template-columns: 1fr; }
            .tx-table td:nth-child(5) { display: none; }
            .tx-table thead th:nth-child(5) { display: none; }
        }

        @media (max-width: 480px) {
            .chart-container { height: 220px; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>S&P 500 ë‚´ë¶€ì ê±°ë˜ íŠ¸ë˜ì»¤</h1>
            <p>SEC Form 4 ê¸°ë°˜ Â· ì„ì›/ì´ì‚¬ ë§¤ìˆ˜Â·ë§¤ë„ ì¶”ì  Â· Finnhub API</p>
        </header>

        <!-- Controls -->
        <div class="controls">
            <div class="control-group">
                <span class="control-label">ê¸°ê°„:</span>
                <button class="ctrl-btn" data-period="30" onclick="setPeriod(30, this)">30ì¼</button>
                <button class="ctrl-btn active" data-period="90" onclick="setPeriod(90, this)">90ì¼</button>
                <button class="ctrl-btn" data-period="180" onclick="setPeriod(180, this)">180ì¼</button>
            </div>
            <div class="control-group">
                <span class="control-label">í•„í„°:</span>
                <button class="ctrl-btn active" data-filter="all" onclick="setFilter('all', this)">ì „ì²´</button>
                <button class="ctrl-btn" data-filter="buy" onclick="setFilter('buy', this)">ë§¤ìˆ˜</button>
                <button class="ctrl-btn" data-filter="sell" onclick="setFilter('sell', this)">ë§¤ë„</button>
            </div>
            <button class="refresh-btn" id="refreshBtn" onclick="loadAllData()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 4v6h6"/><path d="M23 20v-6h-6"/><path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/></svg>
                Refresh
            </button>
        </div>

        <!-- Summary -->
        <div class="summary-row" id="summaryRow">
            <div class="summary-item"><span class="label">ì´ ë§¤ìˆ˜</span><span id="sumBuys" style="color:var(--bid-color)">â€”</span></div>
            <div class="summary-item"><span class="label">ì´ ë§¤ë„</span><span id="sumSells" style="color:var(--ask-color)">â€”</span></div>
            <div class="summary-item"><span class="label">Buy/Sell</span><span id="sumRatio">â€”</span></div>
            <div class="summary-item"><span class="label">ì´ ê±°ë˜</span><span id="sumTotal">â€”</span></div>
            <div class="summary-item"><span class="label">Updated</span><span id="sumUpdated" style="color:var(--text-muted)">â€”</span></div>
        </div>

        <!-- Stats -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-label">ë§¤ìˆ˜ ê±´ìˆ˜</div>
                <div class="stat-value" style="color:var(--bid-color)" id="statBuyCount">â€”</div>
                <div class="stat-sub" id="statBuyVal">â€”</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ë§¤ë„ ê±´ìˆ˜</div>
                <div class="stat-value" style="color:var(--ask-color)" id="statSellCount">â€”</div>
                <div class="stat-sub" id="statSellVal">â€”</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ë§¤ìˆ˜/ë§¤ë„ ë¹„ìœ¨</div>
                <div class="stat-value" id="statRatio">â€”</div>
                <div class="stat-sub" id="statRatioLabel">â€”</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ê±°ë˜ ê¸°ì—… ìˆ˜</div>
                <div class="stat-value" style="color:var(--text-primary)" id="statCompanies">â€”</div>
                <div class="stat-sub" id="statCompaniesLabel">â€”</div>
            </div>
        </div>

        <!-- Buy vs Sell Chart -->
        <section class="section">
            <div class="section-title">
                <h2>ğŸ“Š ë§¤ìˆ˜ vs ë§¤ë„ ê¸ˆì•¡</h2>
                <p>ë‚´ë¶€ì ì´ ê±°ë˜ ê¸ˆì•¡ ë¹„êµ</p>
            </div>
            <div class="chart-container">
                <canvas id="donutChart"></canvas>
            </div>
        </section>

        <!-- Transaction Feed -->
        <section class="section">
            <div class="section-title">
                <h2>ğŸ“‹ ìµœê·¼ ë‚´ë¶€ì ê±°ë˜ ë‚´ì—­</h2>
                <p>SEC Form 4 ì œì¶œ ê¸°ì¤€ Â· ìµœì‹ ìˆœ ì •ë ¬</p>
            </div>
            <div id="txArea">
                <div class="loading-box" id="mainLoading">
                    <div class="spinner"></div>
                    <div class="msg" id="loadingMsg">Finnhub APIì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                    <div class="progress-bar-wrap"><div class="progress-bar-fill" id="progressBar" style="width:0%"></div></div>
                </div>
            </div>
        </section>

        <!-- Top Insiders -->
        <section class="section">
            <div class="section-title">
                <h2>ğŸ† Top ë‚´ë¶€ì</h2>
                <p>ê±°ë˜ ê¸ˆì•¡ ê¸°ì¤€ ìƒìœ„ 5ëª…</p>
            </div>
            <div class="insiders-grid" id="insidersGrid">
                <div class="insider-card" id="topBuyersCard">
                    <h3><span style="color:var(--bid-color)">â–²</span> Top ë§¤ìˆ˜ì</h3>
                    <div id="topBuyers"><div class="no-data">ë¡œë”© ì¤‘...</div></div>
                </div>
                <div class="insider-card" id="topSellersCard">
                    <h3><span style="color:var(--ask-color)">â–¼</span> Top ë§¤ë„ì</h3>
                    <div id="topSellers"><div class="no-data">ë¡œë”© ì¤‘...</div></div>
                </div>
            </div>
        </section>

        <!-- Sector Breakdown -->
        <section class="section">
            <div class="section-title">
                <h2>ğŸ¢ ì„¹í„°ë³„ ë‚´ë¶€ì ê±°ë˜</h2>
                <p>ë§¤ìˆ˜(ì´ˆë¡) vs ë§¤ë„(ë¹¨ê°•) ê¸ˆì•¡ ë¹„ìœ¨</p>
            </div>
            <div id="sectorBars"><div class="no-data">ë¡œë”© ì¤‘...</div></div>
        </section>

        <!-- Share -->
        <div class="share-bar">
            <button class="share-btn twitter" onclick="shareTwitter()">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                íŠ¸ìœ„í„°
            </button>
            <button class="share-btn kakao" onclick="shareKakao()">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3C6.477 3 2 6.463 2 10.691c0 2.724 1.8 5.116 4.508 6.482-.144.525-.925 3.388-.958 3.603 0 0-.02.157.083.217.103.06.224.013.224.013.296-.041 3.434-2.263 3.973-2.652.703.098 1.428.15 2.17.15 5.523 0 10-3.463 10-7.813C22 6.463 17.523 3 12 3z"/></svg>
                ì¹´ì¹´ì˜¤í†¡
            </button>
            <button class="share-btn telegram" onclick="shareTelegram()">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.479.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>
                í…”ë ˆê·¸ë¨
            </button>
            <button class="share-btn instagram" onclick="shareInstagram()">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg>
                ì¸ìŠ¤íƒ€ê·¸ë¨
            </button>
            <button class="share-btn copy-link" onclick="copyLink()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
                ë§í¬ ë³µì‚¬
            </button>
        </div>

        <footer class="footer">
            S&P 500 Insider Trading Tracker â€” SEC Form 4 ê¸°ë°˜<br>
            Finnhub API Â· ë‚´ë¶€ì(ì„ì›/ì´ì‚¬/ëŒ€ì£¼ì£¼) ë§¤ìˆ˜Â·ë§¤ë„ ì¶”ì <br>
            <a href="https://herdvibe.com" target="_blank">herdvibe.com</a>
        </footer>
    </div>

    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.4/kakao.min.js" crossorigin="anonymous"></script>

    <script>
        // ============================================================
        // CONFIG
        // ============================================================
        const KAKAO_KEY = 'a43ed7b39fac35458f4f9df925a279b5';
        const SHARE_URL = 'https://herdvibe.com/89';
        const API_KEY = 'd649u8pr01qkcggqpmp0d649u8pr01qkcggqpmpg';
        const BASE = 'https://finnhub.io/api/v1';

        // S&P 500 major companies + sectors
        const SP500 = {
            AAPL:{n:'Apple',s:'Technology'},MSFT:{n:'Microsoft',s:'Technology'},AMZN:{n:'Amazon',s:'Consumer'},
            NVDA:{n:'NVIDIA',s:'Technology'},GOOGL:{n:'Alphabet',s:'Technology'},META:{n:'Meta',s:'Technology'},
            TSLA:{n:'Tesla',s:'Consumer'},JPM:{n:'JPMorgan',s:'Financials'},V:{n:'Visa',s:'Financials'},
            JNJ:{n:'J&J',s:'Healthcare'},UNH:{n:'UnitedHealth',s:'Healthcare'},XOM:{n:'ExxonMobil',s:'Energy'},
            WMT:{n:'Walmart',s:'Consumer'},MA:{n:'Mastercard',s:'Financials'},PG:{n:'P&G',s:'Consumer'},
            HD:{n:'Home Depot',s:'Consumer'},CVX:{n:'Chevron',s:'Energy'},MRK:{n:'Merck',s:'Healthcare'},
            ABBV:{n:'AbbVie',s:'Healthcare'},KO:{n:'Coca-Cola',s:'Consumer'},PEP:{n:'PepsiCo',s:'Consumer'},
            AVGO:{n:'Broadcom',s:'Technology'},LLY:{n:'Eli Lilly',s:'Healthcare'},COST:{n:'Costco',s:'Consumer'},
            TMO:{n:'Thermo Fisher',s:'Healthcare'},MCD:{n:'McDonald\'s',s:'Consumer'},ABT:{n:'Abbott',s:'Healthcare'},
            CSCO:{n:'Cisco',s:'Technology'},ACN:{n:'Accenture',s:'Technology'},NKE:{n:'Nike',s:'Consumer'},
            NEE:{n:'NextEra',s:'Utilities'},CRM:{n:'Salesforce',s:'Technology'},LIN:{n:'Linde',s:'Materials'},
            ORCL:{n:'Oracle',s:'Technology'},AMD:{n:'AMD',s:'Technology'},INTC:{n:'Intel',s:'Technology'},
            BA:{n:'Boeing',s:'Industrials'},RTX:{n:'RTX',s:'Industrials'},CAT:{n:'Caterpillar',s:'Industrials'},
            GE:{n:'GE',s:'Industrials'},DE:{n:'Deere',s:'Industrials'},UPS:{n:'UPS',s:'Industrials'},
            GS:{n:'Goldman Sachs',s:'Financials'},MS:{n:'Morgan Stanley',s:'Financials'},BLK:{n:'BlackRock',s:'Financials'},
            AXP:{n:'Amex',s:'Financials'},SPGI:{n:'S&P Global',s:'Financials'},DUK:{n:'Duke Energy',s:'Utilities'},
            SO:{n:'Southern Co',s:'Utilities'},AMT:{n:'American Tower',s:'Real Estate'},PLD:{n:'Prologis',s:'Real Estate'},
            COP:{n:'ConocoPhillips',s:'Energy'},SLB:{n:'Schlumberger',s:'Energy'},EOG:{n:'EOG',s:'Energy'},
            APD:{n:'Air Products',s:'Materials'},SHW:{n:'Sherwin-Williams',s:'Materials'},
            ADBE:{n:'Adobe',s:'Technology'},NOW:{n:'ServiceNow',s:'Technology'},INTU:{n:'Intuit',s:'Technology'},
            QCOM:{n:'Qualcomm',s:'Technology'},ISRG:{n:'Intuitive Surg.',s:'Healthcare'},GILD:{n:'Gilead',s:'Healthcare'},
            AMGN:{n:'Amgen',s:'Healthcare'},MDT:{n:'Medtronic',s:'Healthcare'},PFE:{n:'Pfizer',s:'Healthcare'},
            BMY:{n:'Bristol-Myers',s:'Healthcare'},T:{n:'AT&T',s:'Telecom'},VZ:{n:'Verizon',s:'Telecom'},
            TMUS:{n:'T-Mobile',s:'Telecom'},DIS:{n:'Disney',s:'Consumer'},NFLX:{n:'Netflix',s:'Consumer'},
            CMCSA:{n:'Comcast',s:'Consumer'},PM:{n:'Philip Morris',s:'Consumer'},
        };

        let allTransactions = [];
        let currentPeriod = 90;
        let currentFilterType = 'all';
        let donutChart = null;

        // ============================================================
        // API
        // ============================================================
        async function fetchFinnhub(endpoint) {
            const sep = endpoint.includes('?') ? '&' : '?';
            const url = `${BASE}${endpoint}${sep}token=${API_KEY}`;
            const res = await fetch(url);
            if (!res.ok) throw new Error(`API ${res.status}`);
            return res.json();
        }

        const sleep = ms => new Promise(r => setTimeout(r, ms));

        // ============================================================
        // LOAD DATA
        // ============================================================
        async function loadAllData() {
            const btn = document.getElementById('refreshBtn');
            btn.classList.add('loading');

            document.getElementById('txArea').innerHTML = `
                <div class="loading-box" id="mainLoading">
                    <div class="spinner"></div>
                    <div class="msg" id="loadingMsg">Finnhub APIì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                    <div class="progress-bar-wrap"><div class="progress-bar-fill" id="progressBar" style="width:0%"></div></div>
                </div>`;

            try {
                const symbols = Object.keys(SP500);
                let allTx = [];
                const batchSize = 25;
                const totalBatches = Math.ceil(symbols.length / batchSize);

                for (let b = 0; b < totalBatches; b++) {
                    const batch = symbols.slice(b * batchSize, (b + 1) * batchSize);
                    const promises = batch.map(sym =>
                        fetchFinnhub(`/stock/insider-transactions?symbol=${sym}`)
                            .then(data => (data && data.data) ? data.data.map(tx => ({ ...tx, _sym: sym })) : [])
                            .catch(() => [])
                    );

                    const results = await Promise.all(promises);
                    results.forEach(arr => allTx.push(...arr));

                    const pct = Math.round(((b + 1) / totalBatches) * 100);
                    const msgEl = document.getElementById('loadingMsg');
                    const barEl = document.getElementById('progressBar');
                    if (msgEl) msgEl.textContent = `ë°ì´í„° ë¡œë”© ì¤‘... ${pct}% (${Math.min((b+1)*batchSize, symbols.length)}/${symbols.length} ì¢…ëª©)`;
                    if (barEl) barEl.style.width = pct + '%';

                    if (b < totalBatches - 1) await sleep(1500);
                }

                // Filter & sort
                const now = Date.now();
                const dayMs = 86400000;

                allTransactions = allTx
                    .filter(tx => {
                        const t = (tx.transactionType || '').toUpperCase();
                        const isRelevant = t === 'P' || t === 'S' || t === 'P - PURCHASE' || t === 'S - SALE'
                            || t.includes('PURCHASE') || t.includes('SALE');
                        const txDate = new Date(tx.transactionDate || tx.filingDate);
                        const isRecent = (now - txDate.getTime()) < (currentPeriod * dayMs);
                        return isRelevant && isRecent && tx.share && tx.share !== 0;
                    })
                    .sort((a, b) => new Date(b.transactionDate || b.filingDate) - new Date(a.transactionDate || a.filingDate));

                renderAll();
                document.getElementById('sumUpdated').textContent = new Date().toLocaleTimeString('ko-KR');

            } catch (err) {
                document.getElementById('txArea').innerHTML = `
                    <div class="error-box">
                        <div class="emoji">âš ï¸</div>
                        <div class="msg">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤</div>
                        <div class="detail">${err.message}</div>
                    </div>`;
            }

            btn.classList.remove('loading');
        }

        // ============================================================
        // BUY/SELL CLASSIFY
        // ============================================================
        function isBuy(tx) {
            const t = (tx.transactionType || '').toUpperCase();
            if (t === 'P' || t.includes('PURCHASE') || t.includes('BUY') || t === 'P - PURCHASE') return true;
            if (t === 'S' || t.includes('SALE') || t.includes('SELL') || t === 'S - SALE') return false;
            return (tx.change || 0) > 0;
        }

        // ============================================================
        // CONTROLS
        // ============================================================
        function setPeriod(days, btn) {
            document.querySelectorAll('[data-period]').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentPeriod = days;
            loadAllData();
        }

        function setFilter(type, btn) {
            document.querySelectorAll('[data-filter]').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentFilterType = type;
            renderTransactions();
        }

        // ============================================================
        // RENDER
        // ============================================================
        function renderAll() {
            renderSummary();
            renderStats();
            renderDonut();
            renderTransactions();
            renderTopInsiders();
            renderSectors();
        }

        function getFiltered() {
            if (currentFilterType === 'buy') return allTransactions.filter(isBuy);
            if (currentFilterType === 'sell') return allTransactions.filter(tx => !isBuy(tx));
            return allTransactions;
        }

        // --- Summary ---
        function renderSummary() {
            const buys = allTransactions.filter(isBuy);
            const sells = allTransactions.filter(tx => !isBuy(tx));
            const ratio = sells.length > 0 ? (buys.length / sells.length).toFixed(2) : 'âˆ';

            document.getElementById('sumBuys').textContent = buys.length + 'ê±´';
            document.getElementById('sumSells').textContent = sells.length + 'ê±´';
            document.getElementById('sumRatio').textContent = ratio;
            document.getElementById('sumTotal').textContent = allTransactions.length + 'ê±´';
        }

        // --- Stats ---
        function renderStats() {
            const buys = allTransactions.filter(isBuy);
            const sells = allTransactions.filter(tx => !isBuy(tx));
            const buyVal = buys.reduce((s, tx) => s + Math.abs((tx.share||0) * (tx.transactionPrice||0)), 0);
            const sellVal = sells.reduce((s, tx) => s + Math.abs((tx.share||0) * (tx.transactionPrice||0)), 0);
            const ratio = sells.length > 0 ? (buys.length / sells.length).toFixed(2) : 'âˆ';
            const uniqueSyms = new Set(allTransactions.map(tx => tx.symbol || tx._sym)).size;

            document.getElementById('statBuyCount').textContent = buys.length;
            document.getElementById('statBuyVal').textContent = '$' + fmtNum(buyVal);
            document.getElementById('statSellCount').textContent = sells.length;
            document.getElementById('statSellVal').textContent = '$' + fmtNum(sellVal);
            document.getElementById('statRatio').textContent = ratio;
            document.getElementById('statRatioLabel').textContent = ratio > 1 ? 'ë§¤ìˆ˜ ìš°ìœ„ â–²' : ratio < 1 ? 'ë§¤ë„ ìš°ìœ„ â–¼' : 'ê· í˜•';
            document.getElementById('statRatio').style.color = ratio > 1 ? 'var(--bid-color)' : ratio < 1 ? 'var(--ask-color)' : 'var(--text-primary)';
            document.getElementById('statCompanies').textContent = uniqueSyms;
            document.getElementById('statCompaniesLabel').textContent = 'S&P 500 ì¤‘';
        }

        // --- Donut ---
        function renderDonut() {
            const buys = allTransactions.filter(isBuy);
            const sells = allTransactions.filter(tx => !isBuy(tx));
            const buyVal = buys.reduce((s, tx) => s + Math.abs((tx.share||0) * (tx.transactionPrice||0)), 0);
            const sellVal = sells.reduce((s, tx) => s + Math.abs((tx.share||0) * (tx.transactionPrice||0)), 0);

            if (donutChart) donutChart.destroy();
            const ctx = document.getElementById('donutChart').getContext('2d');

            donutChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ë§¤ìˆ˜ (Buy)', 'ë§¤ë„ (Sell)'],
                    datasets: [{
                        data: [buyVal, sellVal],
                        backgroundColor: ['rgba(0,212,170,0.8)', 'rgba(255,71,87,0.8)'],
                        borderColor: ['rgba(0,212,170,0.3)', 'rgba(255,71,87,0.3)'],
                        borderWidth: 2, hoverOffset: 8,
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false, cutout: '65%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#888', font: { family: 'Noto Sans KR', size: 11 }, padding: 20, usePointStyle: true, pointStyleWidth: 10 }
                        },
                        tooltip: {
                            backgroundColor: '#1a1a1a', borderColor: '#2a2a2a', borderWidth: 1,
                            titleFont: { family: 'Noto Sans KR', size: 12 },
                            bodyFont: { family: 'JetBrains Mono', size: 12 },
                            callbacks: { label: ctx => ' $' + fmtNum(ctx.parsed) }
                        }
                    }
                }
            });
        }

        // --- Transactions ---
        function renderTransactions() {
            const filtered = getFiltered();
            if (filtered.length === 0) {
                document.getElementById('txArea').innerHTML = '<div class="no-data">í•´ë‹¹ ì¡°ê±´ì˜ ê±°ë˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            let html = `<div class="table-scroll"><table class="tx-table"><thead><tr>
                <th>ì¢…ëª©</th><th>ë‚´ë¶€ì</th><th>ìœ í˜•</th><th>ê±°ë˜ê¸ˆì•¡</th><th>ë‚ ì§œ</th>
            </tr></thead><tbody>`;

            filtered.slice(0, 200).forEach(tx => {
                const sym = tx.symbol || tx._sym || 'â€”';
                const info = SP500[sym] || { n: sym, s: '' };
                const buy = isBuy(tx);
                const val = Math.abs((tx.share||0) * (tx.transactionPrice||0));
                const shares = Math.abs(tx.share||0);
                const name = tx.name || 'Unknown';
                const date = tx.transactionDate || tx.filingDate || '';

                html += `<tr>
                    <td><span class="tx-sym">${sym}</span><span class="tx-company">${info.n}</span></td>
                    <td><span class="tx-name">${truncate(name, 24)}</span><span class="tx-role">${info.s}</span></td>
                    <td><span class="tx-badge ${buy ? 'buy' : 'sell'}">${buy ? 'BUY' : 'SELL'}</span></td>
                    <td class="tx-value">$${fmtNum(val)}<span class="tx-shares">${fmtNum(shares)} shares</span></td>
                    <td class="tx-date">${fmtDate(date)}</td>
                </tr>`;
            });

            html += '</tbody></table></div>';
            document.getElementById('txArea').innerHTML = html;
        }

        // --- Top Insiders ---
        function renderTopInsiders() {
            const buyMap = {}, sellMap = {};

            allTransactions.forEach(tx => {
                const name = tx.name || 'Unknown';
                const val = Math.abs((tx.share||0) * (tx.transactionPrice||0));
                const sym = tx.symbol || tx._sym || '';
                if (isBuy(tx)) {
                    if (!buyMap[name]) buyMap[name] = { total: 0, sym };
                    buyMap[name].total += val;
                } else {
                    if (!sellMap[name]) sellMap[name] = { total: 0, sym };
                    sellMap[name].total += val;
                }
            });

            const topB = Object.entries(buyMap).sort((a,b) => b[1].total - a[1].total).slice(0, 5);
            const topS = Object.entries(sellMap).sort((a,b) => b[1].total - a[1].total).slice(0, 5);

            document.getElementById('topBuyers').innerHTML = topB.length === 0
                ? '<div class="no-data">ë°ì´í„° ì—†ìŒ</div>'
                : topB.map(([name, d], i) => `
                    <div class="insider-row">
                        <div class="insider-rank">${i+1}</div>
                        <div class="insider-avatar buy-av">${name.charAt(0)}</div>
                        <div class="insider-info"><div class="name">${truncate(name, 18)}</div><div class="meta">${d.sym}</div></div>
                        <div class="insider-amt buy-c">+$${fmtNum(d.total)}</div>
                    </div>`).join('');

            document.getElementById('topSellers').innerHTML = topS.length === 0
                ? '<div class="no-data">ë°ì´í„° ì—†ìŒ</div>'
                : topS.map(([name, d], i) => `
                    <div class="insider-row">
                        <div class="insider-rank">${i+1}</div>
                        <div class="insider-avatar sell-av">${name.charAt(0)}</div>
                        <div class="insider-info"><div class="name">${truncate(name, 18)}</div><div class="meta">${d.sym}</div></div>
                        <div class="insider-amt sell-c">-$${fmtNum(d.total)}</div>
                    </div>`).join('');
        }

        // --- Sectors ---
        function renderSectors() {
            const sectors = {};
            allTransactions.forEach(tx => {
                const sym = tx.symbol || tx._sym;
                const info = SP500[sym];
                if (!info) return;
                const sec = info.s;
                if (!sectors[sec]) sectors[sec] = { buys: 0, sells: 0 };
                const val = Math.abs((tx.share||0) * (tx.transactionPrice||0));
                if (isBuy(tx)) sectors[sec].buys += val;
                else sectors[sec].sells += val;
            });

            const sorted = Object.entries(sectors).sort((a,b) => (b[1].buys + b[1].sells) - (a[1].buys + a[1].sells));
            if (sorted.length === 0) {
                document.getElementById('sectorBars').innerHTML = '<div class="no-data">ì„¹í„° ë°ì´í„° ì—†ìŒ</div>';
                return;
            }

            document.getElementById('sectorBars').innerHTML = sorted.map(([name, d]) => {
                const total = d.buys + d.sells;
                const buyPct = total > 0 ? (d.buys / total * 100) : 50;
                const sellPct = 100 - buyPct;
                return `<div class="sector-row">
                    <div class="sector-label">
                        <span class="name">${name}</span>
                        <span class="val">B $${fmtNum(d.buys)} / S $${fmtNum(d.sells)}</span>
                    </div>
                    <div class="sector-track">
                        <div class="sector-fill-buy" style="width:${buyPct}%"></div>
                        <div class="sector-fill-sell" style="width:${sellPct}%"></div>
                    </div>
                </div>`;
            }).join('');
        }

        // ============================================================
        // HELPERS
        // ============================================================
        function fmtNum(n) {
            if (n >= 1e9) return (n / 1e9).toFixed(1) + 'B';
            if (n >= 1e6) return (n / 1e6).toFixed(1) + 'M';
            if (n >= 1e3) return (n / 1e3).toFixed(1) + 'K';
            return Math.round(n).toLocaleString();
        }

        function fmtDate(d) {
            if (!d) return 'â€”';
            const dt = new Date(d);
            return `${dt.getFullYear()}.${String(dt.getMonth()+1).padStart(2,'0')}.${String(dt.getDate()).padStart(2,'0')}`;
        }

        function truncate(str, max) {
            if (!str) return '';
            return str.length > max ? str.slice(0, max) + 'â€¦' : str;
        }

        // ============================================================
        // SHARING
        // ============================================================
        function shareTwitter() {
            const text = 'S&P 500 Insider Trading Tracker\nSEC Form 4 ê¸°ë°˜ ë‚´ë¶€ì ë§¤ìˆ˜Â·ë§¤ë„ ì‹¤ì‹œê°„ ì¶”ì ';
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(SHARE_URL)}`, '_blank');
        }
        function shareKakao() {
            if (!Kakao.isInitialized()) Kakao.init(KAKAO_KEY);
            Kakao.Share.sendDefault({
                objectType: 'feed',
                content: { title: 'S&P 500 Insider Trading', description: 'SEC Form 4 ê¸°ë°˜ ë‚´ë¶€ì ë§¤ìˆ˜Â·ë§¤ë„ ì¶”ì ', imageUrl: '', link: { mobileWebUrl: SHARE_URL, webUrl: SHARE_URL } },
                buttons: [{ title: 'ëŒ€ì‹œë³´ë“œ ë³´ê¸°', link: { mobileWebUrl: SHARE_URL, webUrl: SHARE_URL } }]
            });
        }
        function shareTelegram() {
            window.open(`https://t.me/share/url?url=${encodeURIComponent(SHARE_URL)}&text=${encodeURIComponent('S&P 500 Insider Trading Tracker')}`, '_blank');
        }
        function clipCopy(text) {
            const ta = document.createElement('textarea');
            ta.value = text; ta.style.position = 'fixed'; ta.style.left = '-9999px';
            document.body.appendChild(ta); ta.select();
            try { document.execCommand('copy'); } catch(e) {}
            document.body.removeChild(ta);
            return Promise.resolve();
        }
        function shareInstagram() {
            clipCopy(SHARE_URL).then(() => {
                const btn = document.querySelector('.instagram');
                const orig = btn.innerHTML;
                btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg> ë§í¬ ë³µì‚¬ë¨! ìŠ¤í† ë¦¬ì— ë¶™ì—¬ë„£ê¸°';
                btn.style.borderColor = '#E4405F'; btn.style.color = '#E4405F';
                setTimeout(() => { btn.innerHTML = orig; btn.style.borderColor = ''; btn.style.color = ''; }, 2500);
            });
        }
        function copyLink() {
            clipCopy(SHARE_URL).then(() => {
                const btn = document.querySelector('.copy-link');
                const orig = btn.innerHTML;
                btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg> ë³µì‚¬ë¨!';
                btn.style.borderColor = 'var(--bid-color)'; btn.style.color = 'var(--bid-color)';
                setTimeout(() => { btn.innerHTML = orig; btn.style.borderColor = ''; btn.style.color = ''; }, 2000);
            });
        }

        // ============================================================
        // BOOT
        // ============================================================
        document.addEventListener('DOMContentLoaded', () => {
            loadAllData();
        });
    </script>
</body>
</html>
